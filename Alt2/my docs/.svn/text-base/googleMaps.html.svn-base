<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <title>Experimenting with google maps</title>
    <script src="http://maps.google.com/maps?file=api&amp;v=2.x&amp;key=ABQIAAAA5rSiNSxNrO2ZRkz7Kn85chTJPcoKeHLnrBlCzckG1Yz5JcZYbRS231zqK9Mx_1Q4KWw2AyHpcXtMAQ"
      type="text/javascript"></script>
    <script type="text/javascript">
	
    //<![CDATA[
/*

	var path = [];
		path[0] = new GLatLng(50.1111, -120.1111);
		path[1] = new GLatLng(50.1111, -120.1100);
		path[2] = new GLatLng(50.1111, -120.1089);
		
	function panPath(){
		var map2 = new GMap2(document.getElementById("map2"));
		GEvent.addListener(map2, "click", jumpPath());		
	}
	
	function jumpPath(){
		var map2 = new GMap2(document.getElementById("map2"));
		var center = map2.getCenter();
		for(var i=0; i<3; i++){
			if(center == path[i] && i != 2){
				map2.panTo(path[i+1]);
				break;
			}else{
				map2.panTo(path[0]);
				break;
			}
		}
		var t1 = setTimeout("panPath()", 5000);
		
		
	}
		 
		*/
    function load() {
      if (GBrowserIsCompatible()) {
		map2.setCenter(new GLatLng(41.4411, -115.4444), 6);
		//map2.setMapType(G_SATELLITE_MAP);
		map2.addMapType(G_PHYSICAL_MAP);
		map2.addControl(new GLargeMapControl());
		map2.addControl(new GScaleControl());
		map2.addControl(new GHierarchicalMapTypeControl());
		map2.addControl(new GOverviewMapControl());
		map2.enableContinuousZoom();
		//map2.enableGoogleBar();
		map2.enableScrollWheelZoom();
		//GEvent.addListener(map2, "dblclick", getRandomPlace());
		
		
		/*
		window.setTimeout(function() {
  		map2.panTo(new GLatLng(45.58, -73.63));
		}, 2000); 
		
	
		var center = map2.getCenter();
		var listener = GEvent.addListener(
    	map2, "moveend", function() {
      map2.openInfoWindowHtml(map2.getCenter(),
    "<center>This is the center of your map and the coordinates are "+ map2.getCenter().toString() +"</center>");
     ///GEvent.removeListener(listener);
});
	
	
	
  }
});	

 GEvent.addListener(map2, "dblclick", function(){
 		alert(map2.getZoom()); });
 */
	GEvent.addListener(map2, "click", function(){
	 	var address = document.getElementById("address").value;
	 	var geocoder = new GClientGeocoder;
		geocoder.getLatLng(address, 
		function(point) {
	  		if (point) {
	    		map2.clearOverlays();
			    map2.addOverlay(new GMarker(point));
			    map2.setCenter(point, 10);
			}
		});
	});
      
      
      
      
      
      }//end if
    }// end func
    
    function getRandomPlace(){
    	var map2 = new GMap2(document.getElementById("map2"));
    	map2.setCenter(new GLatLng(50 * Math.random(), -120 * Math.random()), 4);
    	map2.panTo(new GLatLng(50 * Math.random(), -120 * Math.random()));
    	//var t = setTimeout("getRandomPlace()", 5000);
    }
    
    function mySetMapType(type){
    	var map2 = new GMap2(document.getElementById("map2"));
		map2.setCenter(new GLatLng(41.4411, -115.4444), 3);
		map2.setMapType(type);
    	
    	
    }
    
    function addMarker(map, type){
    	var pic = new GIcon();
    	if(type == 'photo'){
    		pic.image = "http://westonsigns.com/images/WSCL1_P_FIRE.jpg";
    	}else{
    		pic.image = "http://www.perspexletters.co.uk/images/moulded%20letter-e.jpg";
    	}
    	pic.iconAnchor = new GPoint(6, 20);
    	pic.iconSize = new GSize(60,40);
    	var opts = {title: "beffsdee",  draggable: true, icon:pic};
    	var marker = new GMarker(map.getCenter(), opts);
		map.addOverlay(marker);
		
    	
    }
    
function saveMarker(map){
    	var center = map.getCenter().toString();
    	var serverTalk;
    	if (window.XMLHttpRequest)
        { // Mozilla, Safari, ...
       		serverTalk = new XMLHttpRequest();
        }
        else if (window.ActiveXObject)
        { // IE
            try
            {
                serverTalk = new ActiveXObject("Msxml2.XMLHTTP");
            }
            catch (e)
            {
                try
                {
                    serverTalk = new ActiveXObject("Microsoft.XMLHTTP");
                }
                catch (e)
                {
                }
            }
        }

        if (!serverTalk)
        {
           alert('Your browswer does not support this functionality, we suggest you upgrade.');
        }

        serverTalk.onreadystatechange = function()
        {
            writeToServer(serverTalk);
        };
	
	serverTalk.open("POST", "storeData.php" ,true);
	serverTalk.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8");
	serverTalk.send("center=" + center); // we need to send the action here of whatever was clicked
}

  	function writeToServer(serverTalk)
    {
		var showSuccess = document.getElementById("showSuccess");
			//alert(flagArrow);
        if (serverTalk.readyState == 1)
        {
           // Do we want to do anything?
        }
        else if (serverTalk.readyState == 4)
        {
            if (serverTalk.status == 200)
            {	
			    //alert('you have successfully logged yo shit');
				showSuccess.innerHTML = 'holler ' + serverTalk.responseText;
            }
            else
            {
            }
        }	
    }

   

//]]>
    
    
   // 32.95336814579932, -79.60693359375)
    var t;
  	var i = -79.60693359375;
  	
    function panTheTrip(map){
    	//var marker = new GMarker
    	var long = 32.95336814579932;
    	var lat = -79.60693359375;
    	//var beginCoords = new GLatLng(lat, long);
    		i--;
    		map.panTo(new GLatLng(long, i));
    		var t = setTimeout("panTheTrip()",5000);
    		
    	
    }
    
    function bumpMarker(map, marker){
    	map.getOverLay(marker)
    	alert(marker.getLatLng());
    	//marker.setLatLng(point)
    }
    
 
</script>
  </head>
  <body  onload="load()" onunload="GUnload()">
    <table>
    	<tr>
    		<td colspan="2">
    			Google maps tracking trial
    		</td>
    	</tr>
		<tr>
			<td><div style="border:2px solid black"><div id="map2" style="width: 800px; height: 600px"></div></div>
			</td>
			<td>
   				<!-- Select a <a href="javascript:getRandomPlace()">random location</a> to show up on the map <br />
   				Select a map type <a href="javascript:mySetMapType(G_SATELLITE_MAP)">Satellite</a>, 
   				<a href="javascript:mySetMapType(G_NORMAL_MAP)">Regular</a>, 
   				<a href="javascript:mySetMapType(G_HYBRID_MAP)">Hybrid</a>
   				<br />
   				Attempting the <a href="javascript:panPath()">panning</a> thing.
   				<br /> -->
   				<form name="geoCode">
	   				<input type="text" id="address" value="type in address to map" /><br />
	   				<input type="button" value="add a photo" onclick="javascript:addMarker(map2, 'photo')" /><br />
	   				<input type="button" value="add a event" onclick="javascript:addMarker(map2, 'event')" /><br />
	   				<input type="button" value="save marker" onclick="javascript:saveMarker(map2)" /><br />
	   				<input type="button" value="start panning" onclick="javascript:panTheTrip(map2)" /><br />
	   				<span id="showSuccess"></span>
	   				
   				</form>
  		    </td>
  		</tr>
  	</table>
  </body>
</html>
<script type="text/javascript">
    	var map2 = new GMap2(document.getElementById("map2"));
</script>